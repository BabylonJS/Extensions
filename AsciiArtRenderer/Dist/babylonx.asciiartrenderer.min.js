var __decorate=this&&this.__decorate||function(t,e,i,r){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(t,e,i,r);switch(arguments.length){case 2:return t.reduceRight(function(t,e){return e&&e(t)||t},e);case 3:return t.reduceRight(function(t,r){return void(r&&r(e,i))},void 0);case 4:return t.reduceRight(function(t,r){return r&&r(e,i,t)||t},r)}},BABYLONX;!function(t){var e=function(t){function e(e,i,r,n){t.call(this,n),this.name=e,this._text==r,this._font==i,this.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,this.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;var o=this.getFontHeight(i),a=this.getFontWidth(i);this._charSize=Math.max(o.height,a);var c=Math.ceil(this._charSize*r.length),s=this._charSize;this._texture=n.getEngine().createDynamicTexture(c,s,!1,BABYLON.Texture.NEAREST_SAMPLINGMODE);var l=this.getSize(),f=document.createElement("canvas");f.width=l.width,f.height=l.height;var h=f.getContext("2d");h.textBaseline="top",h.font=i,h.fillStyle="white",h.imageSmoothingEnabled=!1;for(var u=0;u<r.length;u++)h.fillText(r[u],u*this._charSize,-o.offset);this.getScene().getEngine().updateDynamicTexture(this._texture,f,!1,!0)}return __extends(e,t),Object.defineProperty(e.prototype,"charSize",{get:function(){return this._charSize},enumerable:!0,configurable:!0}),e.prototype.getFontWidth=function(t){var e=document.createElement("canvas"),i=e.getContext("2d");return i.fillStyle="white",i.font=t,i.measureText("W").width},e.prototype.getFontHeight=function(t){var e=document.createElement("canvas"),i=e.getContext("2d");i.fillRect(0,0,e.width,e.height),i.textBaseline="top",i.fillStyle="white",i.font=t,i.fillText("jH|",0,0);for(var r=i.getImageData(0,0,e.width,e.height).data,n=-1,o=-1,a=0;a<e.height;a++)for(var c=0;c<e.width;c++){var s=4*(a*e.width+c);{if(0!==r[s]){-1===n&&(n=a);break}if(c===e.width-1&&-1!==n){o=a,a=e.height;break}}}return{height:o-n+1,offset:n-1}},e.prototype.clone=function(){return new e(this.name,this._font,this._text,this.getScene())},e.Parse=function(t,i){var r=BABYLON.SerializationHelper.Parse(function(){return new e(t.name,t.font,t.text,i)},t,i,null);return r},__decorate([BABYLON.serialize("font")],e.prototype,"_font"),__decorate([BABYLON.serialize("text")],e.prototype,"_text"),e}(BABYLON.BaseTexture);t.AsciiArtFontTexture=e}(BABYLONX||(BABYLONX={}));var BABYLONX;!function(t){var e=function(){function t(){}return t.ShadersStore={},t}();t.AsciiArtRenderer=e;var i=function(e){function i(i,r,n){var o=this;e.call(this,i,"asciiart",["asciiArtFontInfos","asciiArtOptions"],["asciiArtFont"],{width:r.getEngine().getRenderWidth(),height:r.getEngine().getRenderHeight()},r,BABYLON.Texture.TRILINEAR_SAMPLINGMODE,r.getEngine(),!0),this.mixToTile=0,this.mixToNormal=0;var a="40px Monospace",c=" `-.'_:,\"=^;<+!*?/cL\\zrs7TivJtC{3F)Il(xZfY5S2eajo14[nuyE]P6V9kXpKwGhqAUbOd8#HRDB0$mgMW&Q%N@";n&&("string"==typeof n?a=n:(a=n.font||a,c=n.caracterSet||c,this.mixToTile=n.mixToTile||this.mixToTile,this.mixToNormal=n.mixToNormal||this.mixToNormal)),this._asciiArtFontTexture=new t.AsciiArtFontTexture(i,a,c,r.getScene());var s=this._asciiArtFontTexture.getSize();this.onApply=function(t){t.setTexture("asciiArtFont",o._asciiArtFontTexture),t.setFloat4("asciiArtFontInfos",o._asciiArtFontTexture.charSize,c.length,s.width,s.height),t.setFloat4("asciiArtOptions",o.width,o.height,o.mixToNormal,o.mixToTile)}}return __extends(i,e),i}(BABYLON.PostProcess);t.AsciiArtPostProcess=i}(BABYLONX||(BABYLONX={})),BABYLONX.AsciiArtRenderer.ShadersStore={asciiartPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D asciiArtFont;\n\nuniform vec4 asciiArtFontInfos;\nuniform vec4 asciiArtOptions;\n\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\n\nvoid main(void) \n{\nfloat caracterSize=asciiArtFontInfos.x;\nfloat numChar=asciiArtFontInfos.y-1.0;\nfloat fontx=asciiArtFontInfos.z;\nfloat fonty=asciiArtFontInfos.w;\nfloat screenx=asciiArtOptions.x;\nfloat screeny=asciiArtOptions.y;\nfloat tileX=float(floor((gl_FragCoord.x)/caracterSize))*caracterSize/screenx;\nfloat tileY=float(floor((gl_FragCoord.y)/caracterSize))*caracterSize/screeny;\nvec2 tileUV=vec2(tileX,tileY);\nvec4 tileColor=texture2D(textureSampler,tileUV);\nvec4 baseColor=texture2D(textureSampler,vUV);\nfloat tileLuminance=getLuminance(tileColor.rgb);\nfloat offsetx=(float(floor(tileLuminance*numChar)))*caracterSize/fontx;\nfloat offsety=0.0;\nfloat x=float(mod(gl_FragCoord.x,caracterSize))/fontx;\nfloat y=float(mod(gl_FragCoord.y,caracterSize))/fonty;\nvec4 finalColor=texture2D(asciiArtFont,vec2(offsetx+x,offsety+(caracterSize/fonty-y)));\nfinalColor.rgb*=tileColor.rgb;\nfinalColor.a=1.0;\nfinalColor=mix(finalColor,tileColor,asciiArtOptions.w);\nfinalColor=mix(finalColor,baseColor,asciiArtOptions.z);\ngl_FragColor=finalColor;\n}"},function(){for(var t in BABYLONX.AsciiArtRenderer.ShadersStore)BABYLON.Effect.ShadersStore[t]=BABYLONX.AsciiArtRenderer.ShadersStore[t]}();